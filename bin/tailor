#!/usr/bin/env ruby

$:.unshift(File.dirname(__FILE__) + '/../lib/') unless
  $:.include?(File.dirname(__FILE__) + '/../lib/') ||
  $:.include?(File.expand_path(File.dirname(__FILE__) + '/../lib/'))

require 'tailor'

def usage
  puts "Usage:"
  puts "\t#{File.basename(__FILE__)} [directory with .rb files]"
  puts "\t -OR-"
  puts "\t#{File.basename(__FILE__)} [single .rb file]"
end

if ARGV[0].nil?
  puts usage
else
  begin
    path_to_check = ARGV[0]
    
    # Check to make sure we got a file or directory
    unless File.file?(path_to_check) or File.directory?(path_to_check)
      raise "Invalid file or directory: #{path_to_check}"
    end

    if File.file?(path_to_check)
      files_and_problems = Tailor.check_file path_to_check
    elsif File.directory?(path_to_check)
      # Check the requested files/dirs for problems
      files_and_problems = Tailor.check path_to_check
    end

    # Print summary of the problems we found
    Tailor.print_report files_and_problems
  rescue Exception => ex
    puts ex.message
    puts ex.backtrace
    puts
  end
end
