#!/usr/bin/env ruby

require 'trollop'
require_relative '../lib/tailor'
require_relative '../lib/tailor/cli_helpers'
require_relative '../lib/tailor/runtime_error'


opts = Trollop.options do
  banner Tailor::CLIHelpers.banner
  version Tailor::CLIHelpers.version
end

stuff_to_check = ARGV[0]

if stuff_to_check.nil?
  puts Tailor::CLIHelpers.banner
  exit
end

begin
  unless Tailor.checkable? stuff_to_check
    raise Tailor::RuntimeError, "Invalid file or directory: #{stuff_to_check}"
  end

  Tailor.check_style(stuff_to_check)
  Tailor.print_report
rescue Tailor::RuntimeError => ex
  puts ex.message
  puts ex.backtrace.join("\n")
  puts
ensure
  exit(1) if Tailor.problem_count > 0
end
